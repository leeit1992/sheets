!function(e){"use strict";var t=Backbone.Model.extend({initialize:function(){if(this.get("sheetsNumber")||this.set("sheetsNumber",0),this.get("sheetsWidth")||this.set("sheetsWidth",e("#page_content_inner").width()),!this.get("sheetData")){for(var t=new Array,a=0;a<=10;a++)t.push(["01/06/2017","Hai Trieu","hu shop","CULOTTE PANTS","BJ8187","8","Black","1","22.5","","","22.5","","12/6","","61","http://www.adidas.co.uk/culotte-pants/BJ8187.html"]);this.set("sheetData",t)}this.createView()},colType:function(){return[{editor:"select",selectOptions:function(e,t){return[OPDATA.user.all_info.user_code+"-"+OPDATA.date+"-"+(e+1)]}},{type:"date",dateFormat:"DD/MM/YYYY",correctFormat:!0,defaultDate:"01/01/2017"},{},{},{},{},{},{type:"numeric"},{type:"text"},{},{},{type:"numeric"},{},{editor:"select",selectOptions:["Oke","Out"]},{type:"date",dateFormat:"DD/MM/YYYY",correctFormat:!0,defaultDate:"01/01/2017"},{}]},listCols:function(){return["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T"]},createView:function(){this.view=new a({model:this})},extend:function(){return this}}),a=Backbone.View.extend({el:"#page-canculator",wrapSheets:"#op-content-sheets",noticeTpl:_.template('<div class="uk-notify-message <%= classes %>">                                            <a class="uk-close"></a>                                            <div>                                               <%= message %>                                            </div>                                        </div>'),opSheet:null,events:{"click .op-add-canculator-js":"addCanculator","mouseover .op-toolbar-menu-button":"hoverButtonEditor","click .op-save-sheets-js":"saveSheets","click .op-send-sheet-js":"sendSheets","click #style_switcher_toggle":"openSendMes","change #op_filter_sheet":"actionFilter","click .op-icon-bold":"useFilter","click .op-fx--input input":"fxEvent","change #op_sheet_add_order":"adminChooseOrderer","click .op-apply-orderer":"setOrderer","click .op-icon-add-order":"openSetOrderer","click #op_sheet_order .atl-close":"closeSetOrderer","click .op-apply-sendback":"adminSendBack","click .op-apply-share-sheet":"shareSheet","click .op-apply-transfer-sheet":"transferSheet","click .op-apply-add-row-sheet":"addRowSheet"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.fixWidthCanculator),this.reizeContentCanculator(),this.render();var t=e("#style_switcher");e("#style_switcher_toggle").click(function(e){e.preventDefault(),t.toggleClass("switcher_active")}),e(document).click(function(){e(".op-set-cell").removeClass("op-current")})},render:function(){var e=this.model.get("sheetsNumber");if(0===e)this.canculatorConfig(0,this.model.get("sheetsWidth"));else for(var t=0;t<e;t++)this.canculatorConfig(e,this.model.get("sheetsWidth"))},formatTextHead:function(e,t){return"<p>"+e+"</p><p>"+t+"</p>"},canculatorConfig:function(t,a){var o=this,l=e("#op-sheet-"+t)[0];if(this.setColor(),0!==e("#op_sheet_id",this.el).length){var r=e("#op_sheet_data",this.el),s=e("#op_sheet_meta",this.el),n=new Array;r=JSON.parse(r.val()),s=JSON.parse(s.val()),e.each(s,function(e,t){t.comment&&n.push({row:t.row,col:t.col,comment:{value:t.comment.value}})})}else var r=[],s=[],n=[];Handsontable.TextCell={editor:Handsontable.mobileBrowser?Handsontable.editors.MobileTextEditor:Handsontable.editors.TextEditor,renderer:Handsontable.renderers.TextRenderer},Handsontable.NumericCell={editor:Handsontable.editors.NumericEditor,renderer:Handsontable.renderers.NumericRenderer,validator:Handsontable.NumericValidator,dataType:"number"},this.opSheet=new Handsontable(l,{readOnly:!!window.sheetShareStatus,data:r,startRows:100,rowHeaders:!0,colHeaders:[o.formatTextHead("A","User Code"),o.formatTextHead("B","Date"),o.formatTextHead("C","Buyer"),o.formatTextHead("D","Name items"),o.formatTextHead("E","Code Items"),o.formatTextHead("F","Size"),o.formatTextHead("G","Color"),o.formatTextHead("H","Unit"),o.formatTextHead("I","Price"),o.formatTextHead("J","Ship"),o.formatTextHead("K","Coupon"),o.formatTextHead("L","Total"),o.formatTextHead("M","Link Items"),o.formatTextHead("N","Status"),o.formatTextHead("O","Arrival"),o.formatTextHead("P","Weight"),o.formatTextHead("Q","")],columns:o.model.colType(),rowHeaders:!0,colWidths:100,manualColumnMove:!0,manualRowMove:!0,manualColumnResize:!1,manualRowResize:!1,minSpareRows:!0,filters:!0,dropdownMenu:["filter_by_condition","filter_action_bar"],width:a-30,height:window.outerHeight-258,formulas:!0,contextMenu:2!=OPDATA.user.meta.user_role,comments:!0,modifyColWidth:function(e,t){return 5==t||7==t||13==t||15==t||8==t||11==t||9==t?50:1==t||14==t?80:void 0},afterInit:function(){e("#HandsontableCopyPaste").css("position","absolute"),e("#HandsontableCopyPaste").css("top",0);var t=this;e(".wtHolder",this.container).addClass("op-scroll"),this.OpDataSheets={};var a=e("#op_sheet_id",this.el),o=e("#op_sheet_status",this.el);if(0!==a.length){this.sheetId=a.val(),this.sheetStatus=o.val();var l=e("#op_sheet_meta",this.el);"[]"!=l.val()&&(this.OpDataSheets=JSON.parse(l.val()))}2==OPDATA.user.meta.user_role||OPDATA.user.meta.user_role,setTimeout(function(){r.length;t.setDataAtCell(99,16,"")},500)},AfterAutofill:function(e,t,a,o,l,r,s,n,i,c){var d=new Array;return d.push([this.getSourceDataArray(e-1,t)[e-1][t]]),d},afterFilter:function(t){var a=this,l=this.getData().length+4,r=0,s=new Array,n=0,i=new Array,c=0,d=new Array;this.setDataAtCell(l,3,"Total weight"),this.setDataAtCell(l+1,3,"Quantity of items"),this.setDataAtCell(l+2,3,"Total price"),e.each(this.getData(),function(t,l){e.each(l,function(l,h){e(a.getCell(t,l)).css({background:""}),a.setCellMeta(t,l,"background",""),a.setCellMeta(t,l,"color",""),a.OpDataSheets[t+"-"+l]=a.getCellMeta(t,l),15==l&&h==parseInt(h,10)&&(s.push(o.model.listCols()[l]+""+(t+1)),r+=parseInt(h)),7==l&&h==parseInt(h,10)&&(i.push(o.model.listCols()[l]+""+(t+1)),n+=parseInt(h)),11==l&&h==parseFloat(h,10)&&(d.push(o.model.listCols()[l]+""+(t+1)),c+=parseFloat(h))})}),this.setDataAtCell(l,4,"=SUM("+s.join(",")+")"),this.setDataAtCell(l+1,4,"=SUM("+i.join(",")+")"),this.setDataAtCell(l+2,4,"=SUM("+d.join(",")+")"),a.setCellMeta(l,3,"background","#3b9c71"),a.setCellMeta(l,3,"color","#white"),a.OpDataSheets[l+"-3"]=a.getCellMeta(l,3);for(var h=l;h<=l+2;h++)e(a.getCell(h,3)).css({background:"#3b9c71",color:"white"}),e(a.getCell(h,4)).css({background:"#3b9c71",color:"white"}),a.setCellMeta(h,3,"background","#3b9c71"),a.setCellMeta(h,3,"color","white"),a.OpDataSheets[h+"-3"]=a.getCellMeta(h,3),a.setCellMeta(h,4,"background","#3b9c71"),a.setCellMeta(h,4,"color","white"),a.OpDataSheets[h+"-4"]=a.getCellMeta(h,3)},afterSelection:function(t,a){var o=this,l=this.getDataAtCell(t,a);e(".handsontableInput").val();e(".op-fx--input input").val(l),e(".op-fx--input input").attr("data-row",t),e(".op-fx--input input").attr("data-col",a),2!=this.sheetStatus&&2==OPDATA.user.meta.user_role&&e(".op-fx--input input").change(function(){o.setDataAtCell(t,a,e(this).val())})},cells:function(e,t,a){var o=this;return 2!=this.instance.sheetStatus||2!=OPDATA.user.meta.user_role&&3!=OPDATA.user.meta.user_role||(o.readOnly=!0),2!=t&&13!=t&&14!=t&&15!=t||(o.readOnly=!0),3!=OPDATA.user.meta.user_role&&1!=OPDATA.user.meta.user_role||11!=t&&12!=t&&13!=t&&14!=t&&15!=t||(o.readOnly=!1),window.sheetShareStatus&&(14!=t&&15!=t||(o.readOnly=!1)),1==OPDATA.user.meta.user_role&&(o.readOnly=!1),o.renderer=window.firstRowRenderer,o},cell:n}),Handsontable.hooks.add("afterChange",function(t,a){var o=this;if(t){var l=t[0];o.setCellMeta(l[0],l[1],"fomulas",l[3]),13==l[1]&&"Out"==l[3]&&(e(o.getCell(l[0],l[1])).css({color:"#FF9800"}),o.setCellMeta(l[0],l[1],"color","#FF9800"),o.OpDataSheets[l[0]+"-"+l[1]]=o.getCellMeta(l[0],l[1])),12==l[1]&&e.ajax({url:OPDATA.adminUrl+"lech",type:"GET",data:{link:o.getDataAtCell(l[0],l[1])},success:function(e){var t=JSON.parse(e);o.setDataAtCell(l[0],3,t.title),o.setDataAtCell(l[0],8,t.price),t.code&&o.setDataAtCell(l[0],4,t.code),o.setDataAtCell(l[0],7,1)}}),l[1]}}),Handsontable.hooks.add("afterSelectionEnd",function(t,a,o,l){for(var r=this,s=new Array,n=(new Array,a);n<=l;n++)for(var i=t;i<=o;i++)s.push({row:i,col:n});r.opAfterSelectionEnd=s,r.dataCellSelect={rst:t,cst:a,re:o,ce:l},e(".op-bg-cell-color").spectrum({showPaletteOnly:!0,showPalette:!0,color:"blanchedalmond",palette:[["black","white","blanchedalmond","rgb(255, 128, 0);","hsv 100 70 50"],["red","yellow","green","blue","violet"]],move:function(t){e.each(s,function(a,o){e(r.getCell(o.row,o.col)).css({background:t.toHexString()}),r.setCellMeta(o.row,o.col,"background",t.toHexString()),r.OpDataSheets[o.row+"-"+o.col]=r.getCellMeta(o.row,o.col)})}}),e(".op-text-cell-color").spectrum({showPaletteOnly:!0,showPalette:!0,color:"blanchedalmond",palette:[["black","white","blanchedalmond","rgb(255, 128, 0);","hsv 100 70 50"],["red","yellow","green","blue","violet"]],move:function(t){e.each(s,function(a,o){e(r.getCell(o.row,o.col)).css({color:t.toHexString()}),r.setCellMeta(o.row,o.col,"color",t.toHexString()),r.OpDataSheets[o.row+"-"+o.col]=r.getCellMeta(o.row,o.col)})}})})},fixWidthCanculator:function(){var e=this.model.get("sheetsWidth");this.opSheet.updateSettings({width:e})},setColor:function(){window.firstRowRenderer=function(e,t,a,o,l,r,s){if(Handsontable.renderers.TextRenderer.apply(this,arguments),Handsontable.TextCell.renderer.apply(this,arguments),e.OpDataSheets&&e.OpDataSheets[a+"-"+o]){var n=e.OpDataSheets[a+"-"+o];t.style.color=n.color,t.style.background=n.background,e.setCellMeta(a,o,"background",n.background),e.setCellMeta(a,o,"color",n.color),e.setCellMeta(a,o,"codeId",n.codeId),e.setCellMeta(a,o,"sheetId",n.sheetId),e.setCellMeta(a,o,"sIdCtm",n.sIdCtm),e.setCellMeta(a,o,"rCtm",n.rCtm),e.setCellMeta(a,o,"cCtm",n.cCtm),e.setCellMeta(a,o,"mesId",n.mesId),n.readOnly&&"true"==n.readOnly&&(s.readOnly=!0)}13==o&&("Out"==e.getDataAtCell(a,o)||e.getDataAtCell(a,o))}},addCanculator:function(){var t=parseInt(this.model.get("sheetsNumber"))+1;return e(".op-sheet-tabs-content-js",this.el).append('<li><div class="op-sheet-js" id="op-sheet-'+t+'"/></li>'),e(".op-sheet-tabs-js",this.el).append('<li><a href="#">Sheet '+(t+1)+"</a></li>"),this.model.set("sheetsNumber",t),!1},reizeContentCanculator:function(){var t=this;e(".op-switch-screen-js").click(function(){setTimeout(function(){var a=parseInt(e("#page_content_inner").width());e("body").hasClass("sidebar_main_active")?t.model.set("sheetsWidth",a-40):t.model.set("sheetsWidth",a-26)},500)})},hoverButtonEditor:function(t){e(".op-toolbar-menu-button").each(function(){e(this).removeClass("op-toolbar-menu-button-hover")}),e(t.currentTarget).addClass("op-toolbar-menu-button-hover")},saveSheets:function(t){altair_helpers.content_preloader_show();var a=this,o=(new Array,e(t.currentTarget).attr("data-type"));e.each(this.opSheet.OpDataSheets,function(e,t){a.opSheet.getCellMeta(t.row,t.col).comment&&(a.opSheet.OpDataSheets[e].comment=a.opSheet.getCellMeta(t.row,t.col).comment)}),e.each(this.opSheet.OpDataSheets,function(e,t){t.instance=void 0,t.prop=void 0,t.visualCol=void 0,t.visualRow=void 0,t.renderer=void 0});var l={sheetData:JSON.stringify(this.opSheet.getData()),sheetMeta:JSON.stringify(this.opSheet.OpDataSheets),saveType:o};return this.opSheet.sheetId&&(l.sheetId=this.opSheet.sheetId),e.post(OPDATA.adminUrl+"save-sheets",l,function(){altair_helpers.content_preloader_hide();var t=a.noticeTpl({message:"Save sheet success.",classes:"uk-notify-message-success"});e(".op-notify-js",a.el).html(t).show(),e("#style_switcher").removeClass("switcher_active"),setTimeout(function(){e(".op-notify-js",a.el).fadeOut()},2e3)}),!1},actionFilter:function(t){e(".op-filter-action").each(function(t,a){e(a).fadeOut(200)});var a=e(t.currentTarget).val();e("#op-filter-"+a).fadeIn(200)},useFilter:function(){this.opSheet.updateSettings({columnSummary:[{destinationRow:4,destinationColumn:3,type:"sum",forceNumeric:!0}]})},fxEvent:function(t){var a=e(t.currentTarget).attr("data-col"),o=e(t.currentTarget).attr("data-row");return e(this.opSheet.getCell(o,a)).addClass("op-set-cell op-current"),!1},openSendMes:function(t){var a=this.opSheet;if(2==OPDATA.user.meta.user_role){o=new Array;if(e.each(this.opSheet.opAfterSelectionEnd,function(e,t){3!=t.col&&1!=t.col||null==a.getDataAtCell(t.row,t.col)&&o.push(1)}),0<o.length)return UIkit.modal.alert("Send sheet Error. <p>Please choose row data and please do not leave it blank row data !</p>"),e("#style_switcher").removeClass("switcher_active"),!1;e.each(this.opSheet.opAfterSelectionEnd,function(t,o){if(a.getDataAtCell(o.row,3)){0==o.col&&a.setDataAtCell(o.row,o.col,OPDATA.user.all_info.user_code+"-"+OPDATA.date+"-"+(o.row+1)),e(a.getCell(o.row,o.col)).css({background:"#85817a"}),e(a.getCell(o.row,o.col)).css({color:"#ffffff"}),a.setCellMeta(o.row,o.col,"background"," #85817a"),a.setCellMeta(o.row,o.col,"color","#ffffff"),a.setCellMeta(o.row,o.col,"codeId",OPDATA.user.all_info.user_code+"-"+a.sheetId+"-"+window.ATLLIB.makeid()),a.setCellMeta(o.row,o.col,"sheetId",a.sheetId);var l=a.getCellMeta(o.row,o.col);a.OpDataSheets[o.row+"-"+o.col]=l}})}if(3==OPDATA.user.meta.user_role){var o=new Array;if(e.each(this.opSheet.opAfterSelectionEnd,function(e,t){3!=t.col&&1!=t.col||null==a.getDataAtCell(t.row,t.col)&&o.push(1)}),0<o.length)return UIkit.modal.alert("Send sheet Error. <p>Please choose row data and please do not leave it blank row data !</p>"),e("#style_switcher").removeClass("switcher_active"),!1;e(t.currentTarget).closest("#style_switcher").hasClass("switcher_active")?e.each(this.opSheet.opAfterSelectionEnd,function(t,o){e(a.getCell(o.row,o.col)).css({background:"#85817a"}),e(a.getCell(o.row,o.col)).css({color:"#ffffff"})}):e.each(this.opSheet.opAfterSelectionEnd,function(t,o){e(a.getCell(o.row,o.col)).css({background:"white"}),e(a.getCell(o.row,o.col)).css({color:"#777"})})}},sendSheets:function(){var t=this,a=this.opSheet,o={},l=a.getSourceDataArray(a.dataCellSelect.rst,a.dataCellSelect.cst,a.dataCellSelect.re,a.dataCellSelect.ce);if(0==e("textarea[name=op_mes_description]").val().length)return UIkit.modal.alert("Please enter the description!"),!1;o=this.getCellMetaSelect(a);var r=new Array;if(e.each(l,function(e,t){t[3]&&t[1]||r.push(1)}),0<r.length)return UIkit.modal.alert("Send sheet Error. <p>Please choose row data and please do not leave it blank row data !</p>"),!1;if(3==OPDATA.user.meta.user_role)e.ajax({url:OPDATA.adminUrl+"sendback-inbox",type:"POST",data:{sheetData:JSON.stringify(l),sheetMeta:JSON.stringify(o),title:e("input[name=op_mes_title]").val(),receiver:e("select[name=op_receiver]").val(),message:e("textarea[name=op_mes_description]").val()},success:function(t){var a=JSON.parse(t);a.socketId&&e.each(a.socketId,function(e,t){socket.emit("notice-inbox",t)}),e(".op-save-sheets-js").trigger("click"),altair_helpers.content_preloader_hide(),UIkit.modal.alert("Send back success!")}});else{var s={sheetData:JSON.stringify(l),receiver:e("select[name=op_receiver]").val(),sheetMeta:JSON.stringify(o),message:e("textarea[name=op_mes_description]").val(),title:e("input[name=op_mes_title]").val(),sheetId:this.opSheet.sheetId};altair_helpers.content_preloader_show(),e.post(OPDATA.adminUrl+"send-sheet",s,function(){altair_helpers.content_preloader_hide();var a=t.noticeTpl({message:"Send sheet success.",classes:"uk-notify-message-success"});e(".op-notify-js",t.el).html(a).show(),e("#style_switcher").removeClass("switcher_active"),e(".op-save-sheets-js").trigger("click"),socket.emit("notice-inbox",e("select[name=op_receiver]").val()),setTimeout(function(){e(".op-notify-js",t.el).fadeOut()},2e3)})}return!1},getCellMetaSelect:function(e,t=null,a=!1){for(var o={},l=e.dataCellSelect.cst;l<=e.dataCellSelect.ce;l++)for(r=e.dataCellSelect.rst;r<=e.dataCellSelect.re;r++)(s=e.getCellMeta(r,l)).comment&&(s.comment=s.comment),o[r+"-"+l]=s;for(l=e.dataCellSelect.cst;l<=e.dataCellSelect.ce;l++)for(var r=e.dataCellSelect.rst;r<=e.dataCellSelect.re;r++){e.setCellMeta(r,l,"readOnly","true");var s=e.getCellMeta(r,l);s.instance=void 0,s.prop=void 0,s.visualCol=void 0,s.visualRow=void 0,s.renderer=void 0,t&&13==l&&(s.comment={value:t}),a&&(s.readOnly=a),o[r+"-"+l]=s}return o},adminChooseOrderer:function(t){var a=e(t.currentTarget).val();return e(".op_orderer_list").hide(),e(".op_orderer_"+a).fadeIn(),e(".op-apply-orderer").attr("data-id",a),!1},setOrderer:function(t){altair_helpers.content_preloader_show();var a=this,o=this.opSheet,l={},r=o.getSourceDataArray(o.dataCellSelect.rst,o.dataCellSelect.cst,o.dataCellSelect.re,o.dataCellSelect.ce),s=e(t.currentTarget).attr("data-id"),n=JSON.parse(e("textarea[name=op_orderer_"+s+"]").val());new Array;if(s){e.each(o.opAfterSelectionEnd,function(t,a){if(0<o.getDataAtCell(a.row,0).length){var l=o.OpDataSheets[a.row+"-"+a.col];if(l){e(o.getCell(a.row,a.col)).css({background:n.user_color}),e(o.getCell(a.row,a.col)).css({color:"#ffffff"}),o.setCellMeta(a.row,a.col,"background",n.user_color),o.setCellMeta(a.row,a.col,"color","#ffffff"),o.setCellMeta(a.row,a.col,"codeId",l.codeId),o.setCellMeta(a.row,a.col,"sheetId",o.sheetId),o.setCellMeta(a.row,a.col,"sIdCtm",l.sIdCtm),o.setCellMeta(a.row,a.col,"rCtm",l.rCtm),o.setCellMeta(a.row,a.col,"cCtm",l.cCtm);var r=o.getCellMeta(a.row,a.col);o.OpDataSheets[a.row+"-"+a.col]=r,2==a.col&&o.setDataAtCell(a.row,2,n.user_name)}}}),l=this.getCellMetaSelect(o);var i=window.ATLLIB.makeid(),c={sheetData:JSON.stringify(r),receiver:s,sheetMeta:JSON.stringify(l),message:"Oder #"+i,title:"Oder #"+i,sheetId:this.opSheet.sheetId};e.post(OPDATA.adminUrl+"send-sheet",c,function(){altair_helpers.content_preloader_hide();var t=a.noticeTpl({message:"Add sheet to oderer success.",classes:"uk-notify-message-success"});e(".op-notify-js",a.el).html(t).show(),e(".uk-close").trigger("click"),socket.emit("notice-inbox",s),setTimeout(function(){e(".op-notify-js",a.el).fadeOut(),e(".op-save-sheets-js").trigger("click")},2e3)})}},openSetOrderer:function(){var t=this.opSheet;if(0!=this.checkSelectBeforeSend(t.opAfterSelectionEnd).length)return e(".atl-close").trigger("click"),!1;e.each(t.opAfterSelectionEnd,function(a,o){null!=t.getDataAtCell(o.row,0)&&t.OpDataSheets[o.row+"-"+o.col]&&(e(t.getCell(o.row,o.col)).css({background:"#777"}),e(t.getCell(o.row,o.col)).css({color:"white"}))})},closeSetOrderer:function(){var t=this.opSheet;e.each(t.opAfterSelectionEnd,function(a,o){if(void 0!=t.getDataAtCell(o.row,0)&&0<t.getDataAtCell(o.row,0).length){var l=t.OpDataSheets[o.row+"-"+o.col];l&&(e(t.getCell(o.row,o.col)).css({background:l.background}),e(t.getCell(o.row,o.col)).css({color:l.color}))}})},adminSendBack:function(){altair_helpers.content_preloader_show();var t=this.opSheet,a={},o=t.getSourceDataArray(t.dataCellSelect.rst,t.dataCellSelect.cst,t.dataCellSelect.re,t.dataCellSelect.ce);a=this.getCellMetaSelect(t,"Has Send",!0),e.ajax({url:OPDATA.adminUrl+"sendback-inbox",type:"POST",data:{sheetData:JSON.stringify(o),sheetMeta:JSON.stringify(a),title:e("input[name=op_mes_title]").val(),message:e("textarea[name=op_mes_description]").val()},success:function(t){var a=JSON.parse(t);a.socketId&&e.each(a.socketId,function(e,t){socket.emit("notice-inbox",t)}),e(".uk-modal-close").trigger("click"),e(".op-save-sheets-js").trigger("click"),altair_helpers.content_preloader_hide(),UIkit.modal.alert("Send back success!"),window.location=location.href=""}})},shareSheet:function(){var t=this,a=e("#op_sheet_share_list").val();e.ajax({url:OPDATA.adminUrl+"share-sheet",type:"POST",data:{listID:a,sheetId:t.opSheet.sheetId},success:function(t){var a=JSON.parse(t);a.socketId&&e.each(a.socketId,function(e,t){socket.emit("notice-inbox",t)}),e(".uk-modal-close").trigger("click"),altair_helpers.content_preloader_hide(),UIkit.modal.alert("Share success!")}})},transferSheet:function(){var t=this.opSheet;if(void 0==t.dataCellSelect)return UIkit.modal.alert("Please choose row before transfer sheet."),!1;if(void 0==t.dataCellSelect)return UIkit.modal.alert("Please choose row before transfer sheet."),!1;var a={},o=t.getSourceDataArray(t.dataCellSelect.rst,t.dataCellSelect.cst,t.dataCellSelect.re,t.dataCellSelect.ce),l=e("#op_sheet_transfer_list").val();a=this.getCellMetaSelect(t),altair_helpers.content_preloader_show(),e.ajax({url:OPDATA.adminUrl+"transfer-sheet",type:"POST",data:{sheetData:JSON.stringify(o),sheetMeta:JSON.stringify(a),sheetId:l},success:function(t){e(".uk-modal-close").trigger("click"),altair_helpers.content_preloader_hide(),UIkit.modal.alert("Transfer success!")}})},checkSelectBeforeSend:function(t){var a=new Array,o=this.opSheet;return e.each(t,function(e,t){3!=t.col&&1!=t.col||null==o.getDataAtCell(t.row,t.col)&&a.push(1)}),0<a.length&&UIkit.modal.alert("Send sheet Error. <p>Please choose row data and please do not leave it blank row data !</p>"),a},addRowSheet:function(){var t=this.opSheet,a=e("input[name=op_number_row_sheet]").val();a==parseInt(a,10)?(t.setDataAtCell(a,16," "),e(".uk-modal-close").trigger("click")):e("#table").handsontable("setDataAtCell",0,0,"new value")}});new t}(jQuery);
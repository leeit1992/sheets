!function(e){"use strict";var t=Backbone.Model.extend({initialize:function(){this.get("sheetsNumber")||this.set("sheetsNumber",0),this.get("sheetsWidth")||this.set("sheetsWidth",e("#page_content_inner").width()),this.get("sheetData")||this.set("sheetData",[]),this.createView()},createView:function(){this.view=new s({model:this})},extend:function(){return this}}),s=Backbone.View.extend({el:"#page-canculator",wrapSheets:"#op-content-sheets",noticeTpl:_.template('<div class="uk-notify-message <%= classes %>">                                            <a class="uk-close"></a>                                            <div>                                               <%= message %>                                            </div>                                        </div>'),opSheet:null,events:{"click .op-add-canculator-js":"addCanculator","mouseover .op-toolbar-menu-button":"hoverButtonEditor","click .op-save-sheets-js":"saveSheets"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.fixWidthCanculator),this.reizeContentCanculator(),this.render();var t=e("#style_switcher");e("#style_switcher_toggle").click(function(e){e.preventDefault(),t.toggleClass("switcher_active")}),e(".op-fx--input input").bind("paste",function(e){console.log(e.originalEvent.clipboardData.getData("text/html"))})},render:function(){var e=this.model.get("sheetsNumber");if(0===e)this.canculatorConfig(0,this.model.get("sheetsWidth"));else for(var t=0;t<e;t++)this.canculatorConfig(e,this.model.get("sheetsWidth"))},canculatorConfig:function(t,s){var o=e("#op-sheet-"+t)[0];this.setColor(),this.opSheet=new Handsontable(o,{startRows:200,startCols:26,contextMenu:!0,rowHeaders:!0,colHeaders:!0,manualColumnMove:!0,manualRowMove:!0,manualColumnResize:!0,manualRowResize:!0,minSpareRows:!0,width:s-30,height:window.outerHeight-258,afterInit:function(){e(".wtHolder",this.container).addClass("op-scroll"),this.OpDataSheets={}}}),Handsontable.hooks.add("afterChange",function(t){var s=this;e.each(t,function(t,o){var n=s.getCellMeta(o[0],o[1]);e(n.instance.getCell(o[0],o[1])).css({background:n.background,color:n.color}),s.OpDataSheets[o[0]+"-"+o[1]]={default:o,meta:n}})}),Handsontable.hooks.add("afterSelectionEnd",function(t,s,o,n){for(var a=this,i=new Array,r=s;r<=n;r++)for(var l=t;l<=o;l++)i.push({row:l,col:r});e(".op-bg-cell-color").spectrum({color:"#f00",move:function(t){e.each(i,function(s,o){e(a.getCell(o.row,o.col)).css({background:t.toHexString()}),a.setCellMeta(o.row,o.col,"background",t.toHexString())})}}),e(".op-text-cell-color").spectrum({color:"#f00",move:function(t){e.each(i,function(s,o){e(a.getCell(o.row,o.col)).css({color:t.toHexString()}),a.setCellMeta(o.row,o.col,"color",t.toHexString())})}})})},fixWidthCanculator:function(){var e=this.model.get("sheetsWidth");this.opSheet.updateSettings({width:e})},setColor:function(){window.firstRowRenderer=function(e,t,s,o,n,a,i){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style.fontWeight="bold",t.style.color="green",t.style.background="#CEC"},Handsontable.renderers.registerRenderer("negativeValueRenderer",function(e,t,s,o,n,a,i){Handsontable.renderers.TextRenderer.apply(this,arguments),parseInt(a,10)<0&&(t.className="make-me-red"),a&&""!==a?("Nissan"===a&&(t.style.fontStyle="italic"),t.style.background=""):t.style.background="#EEE"})},addCanculator:function(){var t=parseInt(this.model.get("sheetsNumber"))+1;return e(".op-sheet-tabs-content-js",this.el).append('<li><div class="op-sheet-js" id="op-sheet-'+t+'"/></li>'),e(".op-sheet-tabs-js",this.el).append('<li><a href="#">Sheet '+(t+1)+"</a></li>"),this.model.set("sheetsNumber",t),!1},reizeContentCanculator:function(){var t=this;e(".op-switch-screen-js").click(function(){setTimeout(function(){var s=parseInt(e("#page_content_inner").width());e("body").hasClass("sidebar_main_active")?t.model.set("sheetsWidth",s-40):t.model.set("sheetsWidth",s-26)},500)})},hoverButtonEditor:function(t){e(".op-toolbar-menu-button").each(function(){e(this).removeClass("op-toolbar-menu-button-hover")}),e(t.currentTarget).addClass("op-toolbar-menu-button-hover")},saveSheets:function(){altair_helpers.content_preloader_show();var t=this;new Array;e.each(this.opSheet.OpDataSheets,function(e,t){t.meta.instance=void 0,t.meta.prop=void 0,t.meta.visualCol=void 0,t.meta.visualRow=void 0});var s={sheetTitle:e("input[name=op_sheet_title]").val(),sheetMessage:e("textarea[name=op_sheet_message]").val(),sheetData:JSON.stringify(this.opSheet.OpDataSheets)};return e.post(OPDATA.adminUrl+"save-sheets",s,function(){altair_helpers.content_preloader_hide();var s=t.noticeTpl({message:"Send sheet success.",classes:"uk-notify-message-success"});e(".atl-notify-js",t.el).html(s).show()}),!1}});new t}(jQuery);
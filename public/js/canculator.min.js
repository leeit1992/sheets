!function(e){"use strict";var t=Backbone.Model.extend({initialize:function(){this.get("sheetsNumber")||this.set("sheetsNumber",0),this.get("sheetsWidth")||this.set("sheetsWidth",e("#page_content_inner").width()),this.get("sheetData")||this.set("sheetData",[["","Kia","Nissan","Toyota","Honda"],["2014",-5,"",12,13],["2015","",-11,14,13],["2016","",15,-12,"readOnly"]]),this.createView()},createView:function(){this.view=new n({model:this})},extend:function(){return this}}),n=Backbone.View.extend({el:"#page-canculator",wrapSheets:"#op-content-sheets",opSheet:null,events:{"click .op-add-canculator-js":"addCanculator","mouseover .op-toolbar-menu-button":"hoverButtonEditor"},render:function(){var e=this.model.get("sheetsNumber");if(0===e)this.canculatorConfig(0,this.model.get("sheetsWidth"));else for(var t=0;t<e;t++)this.canculatorConfig(e,this.model.get("sheetsWidth"))},canculatorConfig:function(t,n){var s=e("#op-sheet-"+t)[0];this.opSheet=new Handsontable(s,{startRows:200,startCols:26,contextMenu:!0,rowHeaders:!0,colHeaders:!0,manualColumnMove:!0,manualRowMove:!0,manualColumnResize:!0,manualRowResize:!0,minSpareRows:!0,width:n-30,height:window.outerHeight-258,afterInit:function(){console.log(this),e(".wtHolder",this.container).addClass("op-scroll")},afterSelection:function(e,t,n,s){}})},fixWidthCanculator:function(){var e=this.model.get("sheetsWidth");this.opSheet.updateSettings({width:e})},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change",this.fixWidthCanculator),this.reizeContentCanculator(),this.render(),e(".custom").spectrum({color:"#f00"});var t=e("#style_switcher");e("#style_switcher_toggle").click(function(e){e.preventDefault(),t.toggleClass("switcher_active")})},setColor:function(){window.firstRowRenderer=function(e,t,n,s,o,i,a){Handsontable.renderers.TextRenderer.apply(this,arguments),t.style.fontWeight="bold",t.style.color="green",t.style.background="#CEC"},Handsontable.renderers.registerRenderer("negativeValueRenderer",function(e,t,n,s,o,i,a){Handsontable.renderers.TextRenderer.apply(this,arguments),parseInt(i,10)<0&&(t.className="make-me-red"),i&&""!==i?("Nissan"===i&&(t.style.fontStyle="italic"),t.style.background=""):t.style.background="#EEE"})},addCanculator:function(){var t=parseInt(this.model.get("sheetsNumber"))+1;return e(".op-sheet-tabs-content-js",this.el).append('<li><div class="op-sheet-js" id="op-sheet-'+t+'"/></li>'),e(".op-sheet-tabs-js",this.el).append('<li><a href="#">Sheet '+(t+1)+"</a></li>"),this.model.set("sheetsNumber",t),!1},reizeContentCanculator:function(){var t=this;e(".op-switch-screen-js").click(function(){setTimeout(function(){var n=parseInt(e("#page_content_inner").width());e("body").hasClass("sidebar_main_active")?t.model.set("sheetsWidth",n-40):t.model.set("sheetsWidth",n-26)},300)})},hoverButtonEditor:function(t){e(".op-toolbar-menu-button").each(function(){e(this).removeClass("op-toolbar-menu-button-hover")}),e(t.currentTarget).addClass("op-toolbar-menu-button-hover")}});new t}(jQuery);